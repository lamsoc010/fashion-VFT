<!DOCTYPE html>
<html lang="en">

<%- include('layouts/headAdmin.ejs') %>
<style>
    div#tablePage_wrapper {
    width: 1200px;
}
</style>
    <body>
        <div class="container-fluid">
            <div class="row">
                <!-- left -->
                <%- include('layouts/leftAdmin.ejs') %>
                <!-- right -->
                <div class="col-md-10 main-header ">

                  
                    <!-- form -->
                    <div class="container-fluid border border-primary">
                        <!-- form thêm sản phẩm -->
                        <div id="addProduct">
                            <h4 class="text-primary  my-3">Thêm sản phẩm</h4>
                            <form id="elements" name="form-addproduct" method="POST" action="/admin/product"
                                enctype="multipart/form-data">
                                <div class="row px-4">
                                    <div class="col-md-6">
                                        <!--  Tên sản phẩm -->
                                        <div class="row pr-3">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="inputGroup-sizing-default">Tên
                                                        sản phẩm:</span>
                                                </div>
                                                <input type="text" class="form-control" name="name" required id="name"
                                                    aria-label="Default" aria-describedby="inputGroup-sizing-default">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <!-- giá -->
                                            <div class="col-md-6 ml-0 px-0">
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">Giá (VNĐ)</span>
                                                    </div>
                                                    <input type="number" class="form-control" name="price" required
                                                        id="price" aria-label="Amount (to the nearest dollar)" min="0">
                                                </div>
                                            </div>
                                            <!-- số lượng -->
                                            <div class="col-md-6 ">
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">Số lượng</span>
                                                    </div>
                                                    <input type="number" name="amount" min="0" id="amount"
                                                        class="form-control" required
                                                        aria-label="Amount (to the nearest dollar)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <!-- loại sản phẩm -->
                                        <div class="row">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <label class="input-group-text" for="inputGroupSelect01">Loại sản
                                                        phẩm</label>
                                                </div>
                                                <select class="custom-select" id="type-product" name="productType">
                                                    <option selected>Choose...</option>
                                                    <option value="Thu đông">Thu đông</option>
                                                    <option value="Hè">Hè</option>
                                                    <option value="Thời trang nam">Thời trang nam</option>
                                                    <option value="Thời trang nữ">Thời trang nữ</option>
                                                </select>
                                            </div>
                                        </div>
                                        <!-- Size -->
                                        <div class="row">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <label class="input-group-text" for="inputGroupSelect01">Size sản
                                                        phẩm</label>
                                                </div>
                                                <select class="custom-select" id="size-product" name="size">
                                                    <option selected>Choose...</option>

                                                    <option value="S">Size S</option>
                                                    <option value="L">Size L</option>
                                                    <option value="XL">Size XL</option>
                                                    <option value="XXL">Size XXL</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- mô tả -->
                                <div class="input-group px-2">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Mô tả</span>
                                    </div>
                                    <textarea class="form-control" aria-label="With textarea" name="description"
                                        required id="description"></textarea>
                                </div>
                                <div class="row px-2">
                                    <div class="col-md-6">
                                        <!-- color -->
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend">
                                                <label class="input-group-text" for="inputGroupSelect01">Chọn
                                                    màu</label>
                                            </div>
                                            <select class="custom-select" id="type-product" name="color">
                                                <option selected>Choose...</option>
                                                <option value="Màu trắng">Màu trắng</option>
                                                <option value="Màu đen">Màu đen</option>
                                                <option value="Màu đỏ">Màu đỏ</option>
                                                <option value="màu xanh dương">màu xanh dương</option>
                                            </select>
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <!-- iamge -->
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <!-- <span class="input-group-text">Upload</span> -->
                                            </div>
                                            <div class="custom-file">
                                                <input type="file" class="custom-file-input" id="inputGroupFile01"
                                                    name="image">
                                                <label class="custom-file-label" for="inputGroupFile01">Upload file
                                                    image</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="text-center me-5">
                                        <button type="submit" class="create btn btn-primary me-5">Thêm sản
                                            phẩm</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="editProduct"></div>
                    </div>
                    <!-- table -->
                    <div class="row  itemKhachHang my-5 mx-1">
                        <h3><span class="text-danger"><i class="fa fa-home" aria-hidden="true"></i>
                            </span> danh sách sản phẩm</h3>
                        <!-- <table class="table table-sm table-striped table-hover table-bordered" id="tablePage"> -->
                            <table id="tablePage" class="display nowrap table table-striped" style="width:100%">
                            <thead>
                                <tr>
                                    <th>#STT</th>
                                    <th>HÌNH ẢNH</th>
                                    <th>TÊN SẢN PHẨM</th>
                                    <th>GIÁ</th>
                                    <th>TỔNG SỐ LƯỢNG</th>
                                    <th>THỜI GIAN</th>
                                    <th>CHỈNH SỬA</th>
                                    <th>XÓA</th>
                                </tr>
                            </thead>
                            <tbody id="after_run">

                                <% for(var i=0; i < allProduct.length; i++) { %>
                                    <tr>
                                        <td>
                                            <%= i+1 %>
                                        </td>
                                        <td><img src="<%= allProduct[i].image %>" alt="" width="100px" height="100px">
                                        </td>
                                        <td>
                                            <%= allProduct[i].name %>
                                        </td>
                                        <td>
                                            <%= allProduct[i].price %>
                                        </td>
                                        <td>
                                            <%= allProduct[i].amount %>
                                        </td>
                                        <% if(!allProduct[i].ngayTao){%>
                                        <td>
                                            23/04/2022
                                        </td>
                                        <% } %>
                                        <% if(allProduct[i].ngayTao){%>
                                            <td>
                                                24/04/2022
                                            </td>
                                        <% } %>

                                        <td>
                                            <a id='tr_99' class='text-warning'
                                                onclick="edit('<%= JSON.stringify(allProduct[i])%>', '<%= allProduct[i].id %>')">
                                                <i class="fa fa-pencil-square-o  aria-hidden=" true"></i>
                                            </a>
                                        </td>
                                        <td>
                                            <a href="" class='btn btn-link' data-toggle="modal"
                                                data-target="#delete-product-model" data-id="<%= allProduct[i].id %>">
                                                <i class="fa fa-trash-o" aria-hidden="true"></i>
                                                <!-- xoa -->
                                            </a>
                                        </td>
                                        <% }%>
                                            <!-- confirm  -->
                                            <div class="modal fade" id="delete-product-model" tabindex="-1"
                                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel">Xóa sản phẩm
                                                            </h5>
                                                            <button type="button" class="btn-close border-0"
                                                                data-dismiss="modal" aria-label="Close">X</button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Bạn chắc chắn muốn xóa sản phẩm
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-dark"
                                                                data-dismiss="modal">Hủy</button>
                                                            <button type="button" class="btn btn-danger"
                                                                id="btn-delete-product">Xóa bỏ</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                    </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


            </div>
        </div>
        <!-- Delete hidden form -->
        <form method="POST" name="delete-product-form"></form>
    </body>

</html>
<!-- <script type="text/javascript" src="assets/public-VN/jscript/khachHang.js"></script> -->
<script type="text/javascript" src="assets/public-VN/jscript/menagerment.js"></script>
<script>
    var addproduct = document.getElementById('addProduct');
    var editProduct = document.getElementById('editProduct');
    $(document).ready(function () {
        $('#tablePage').DataTable( {
        // ajax:           "../data/2500.txt",
        deferRender:    true,
        scrollY:        600,
        scrollCollapse: true,
        scroller:       true
         } );
        let numberPage = document.getElementsByClassName('tablePage_length')
        // let giaTri = numberPage.options[].text;
        // console.log(giaTri)



        addproduct.innerHTML = `
            <h4 class="text-primary  my-3">Thêm sản phẩm</h4>
                            <form id="elements" name="form-addproduct" method="POST" action="/admin/product"
                                enctype="multipart/form-data">
                                <div class="row px-4">
                                    <div class="col-md-6">
                                        <!--  Tên sản phẩm -->
                                        <div class="row pr-3">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="inputGroup-sizing-default">Tên
                                                        sản phẩm:</span>
                                                </div>
                                                <input type="text" class="form-control" name="name" required id="name"
                                                    aria-label="Default" aria-describedby="inputGroup-sizing-default">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <!-- giá -->
                                            <div class="col-md-6 ml-0 px-0">
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">Giá (VNĐ)</span>
                                                    </div>
                                                    <input type="number" class="form-control" name="price" required
                                                        id="price" aria-label="Amount (to the nearest dollar)" min="0">
                                                </div>
                                            </div>
                                            <!-- số lượng -->
                                            <div class="col-md-6 ">
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">Số lượng</span>
                                                    </div>
                                                    <input type="number" name="amount" min="0" id="amount"
                                                        class="form-control" required
                                                        aria-label="Amount (to the nearest dollar)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <!-- loại sản phẩm -->
                                        <div class="row">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <label class="input-group-text" for="inputGroupSelect01">Loại sản
                                                        phẩm</label>
                                                </div>
                                                <select class="custom-select" id="type-product" name="productType">
                                                    <option selected>Choose...</option>
                                                    <option value="Thu đông">Thu đông</option>
                                                    <option value="Hè">Hè</option>
                                                    <option value="Thời trang nam">Thời trang nam</option>
                                                    <option value="Thời trang nữ">Thời trang nữ</option>
                                                </select>
                                            </div>
                                        </div>
                                        <!-- Size -->
                                        <div class="row">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <label class="input-group-text" for="inputGroupSelect01">Size sản
                                                        phẩm</label>
                                                </div>
                                                <select class="custom-select" id="size-product" name="size">
                                                    <option selected>Choose...</option>

                                                    <option value="S">Size S</option>
                                                    <option value="L">Size L</option>
                                                    <option value="XL">Size XL</option>
                                                    <option value="XXL">Size XXL</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- mô tả -->
                                <div class="input-group px-2">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Mô tả</span>
                                    </div>
                                    <textarea class="form-control" aria-label="With textarea" name="description"
                                        required id="description"></textarea>
                                </div>
                                <div class="row px-2">
                                    <div class="col-md-6">
                                        <!-- color -->
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend">
                                                <label class="input-group-text" for="inputGroupSelect01">Chọn
                                                    màu</label>
                                            </div>
                                            <select class="custom-select" id="type-product" name="color">
                                                <option selected>Choose...</option>
                                                <option value="Màu trắng">Màu trắng</option>
                                                <option value="Màu đen">Màu đen</option>
                                                <option value="Màu đỏ">Màu đỏ</option>
                                                <option value="màu xanh dương">màu xanh dương</option>
                                            </select>
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <!-- iamge -->
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <!-- <span class="input-group-text">Upload</span> -->
                                            </div>
                                            <div class="custom-file">
                                                <input type="file" class="custom-file-input" id="inputGroupFile01"
                                                    name="image">
                                                <label class="custom-file-label" for="inputGroupFile01">Upload file
                                                    image</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="text-center me-5">
                                        <button type="submit" class="create btn btn-primary me-5">Thêm sản
                                            phẩm</button>
                                    </div>
                                </div>
                            </form>`
    });
    function edit(product, id) {
        var allProduct = JSON.parse(product)
        // let product = i;
        addproduct.innerHTML = ``

        editProduct.innerHTML =
            ` 
            <h4 class="text-primary my-3 ">Chỉnh sửa thông tin sản phẩm</h4>
            <form id="elements" name="form-addproduct" method="POST" action="/admin/product/${id}?_method=PUT" enctype="multipart/form-data"
                enctype="multipart/form-data">
                <div class="row px-4">
                    <div class="col-md-6">
                        <!--  Tên sản phẩm -->
                        <div class="row pr-3">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="inputGroup-sizing-default">Tên
                                        sản phẩm:</span>
                                </div>
                                <input type="text" class="form-control" name="name" required id="name"
                                    aria-label="Default" aria-describedby="inputGroup-sizing-default">
                            </div>
                        </div>
                        <div class="row">
                            <!-- giá -->
                            <div class="col-md-6 ml-0 px-0">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Giá (VNĐ)</span>
                                    </div>
                                    <input type="number" class="form-control" name="price" required
                                        id="price" aria-label="Amount (to the nearest dollar)" min="0">
                                </div>
                            </div>
                            <!-- số lượng -->
                            <div class="col-md-6 ">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Số lượng</span>
                                    </div>
                                    <input type="number" name="amount" min="0" id="amount"
                                        class="form-control" required
                                        aria-label="Amount (to the nearest dollar)">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <!-- loại sản phẩm -->
                        <div class="row">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Loại sản
                                        phẩm</label>
                                </div>
                                <select class="custom-select" id="type-product" name="productType">
                                    <option selected>Choose...</option>
                                    <option value="Thu đông">Thu đông</option>
                                    <option value="Hè">Hè</option>
                                    <option value="Thời trang nam">Thời trang nam</option>
                                    <option value="Thời trang nữ">Thời trang nữ</option>
                                </select>
                            </div>
                        </div>
                        <!-- Size -->
                        <div class="row">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Size sản
                                        phẩm</label>
                                </div>
                                <select class="custom-select" id="size-product" name="size">
                                    <option selected>Choose...</option>

                                    <option value="S">Size S</option>
                                    <option value="L">Size L</option>
                                    <option value="XL">Size XL</option>
                                    <option value="XXL">Size XXL</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- mô tả -->
                <div class="input-group px-2">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Mô tả</span>
                    </div>
                    <textarea class="form-control" aria-label="With textarea" name="description"
                        required id="description"></textarea>
                </div>
                <div class="row px-2">
                    <div class="col-md-6">
                        <!-- color -->
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupSelect01">Chọn
                                    màu</label>
                            </div>
                            <select class="custom-select" id="type-product" name="color">
                                <option selected>Choose...</option>
                                <option value="Màu trắng">Màu trắng</option>
                                <option value="Màu đen">Màu đen</option>
                                <option value="Màu đỏ">Màu đỏ</option>
                                <option value="màu xanh dương">màu xanh dương</option>
                            </select>
                        </div>

                    </div>
                    <div class="col-md-6">
                        <!-- iamge -->
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <!-- <span class="input-group-text">Upload</span> -->
                            </div>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" id="inputGroupFile01"
                                    name="image">
                                <label class="custom-file-label" for="inputGroupFile01">Upload file
                                    image</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="text-center me-5">
                        <button type="submit" class="create btn btn-primary me-5">Chỉnh sửa</button>
                    </div>
                </div>
            </form>`

        document.getElementById('name').value = allProduct.name
        document.getElementById('type-product').value = allProduct.productType
        document.getElementById('price').value = allProduct.price
        document.getElementById('description').value = allProduct.description
        document.getElementById('size-product').value = allProduct.size
        document.getElementById('amount').value = allProduct.amount
        document.forms.elements.elements["color"].value = allProduct.color
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var productId;
        var btnDeletePro = document.getElementById('btn-delete-product');
        var deleteForm = document.forms['delete-product-form'];
        // when dialog confirm clicked
        $('#delete-product-model').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget)
            productId = button.data('id')
            btnDeletePro.onclick = function () {
                deleteForm.action = '/admin/product/' + productId + '?_method=DELETE'
                deleteForm.submit();
            }
        })
    })

</script>